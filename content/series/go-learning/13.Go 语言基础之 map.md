---
title: "Go 语言基础之 map"
description: "掌握 Go 语言的 map 键值对结构，学习其定义、操作和常见用法，对比 JavaScript 对象和 Map。"
date: "2025-11-25"
seriesOrder: 13
---

# 13. Go 语言基础之 map

## 引言

在 JavaScript 中，我们最常用的数据结构可能就是对象（Object）了，比如 `{ name: "Tom", age: 18 }`。在 ES6 之后，我们又有了 `Map`。

Go 语言中的 **map**（映射）就是类似于 JS 对象或 Map 的键值对结构。它是无序的，基于哈希表实现。

## 1. Map 的定义

Map 的定义格式为：`map[KeyType]ValueType`。

```go
// 定义一个键为 string，值为 int 的 map
var scores map[string]int
```

**Key 的限制**：
Go 语言中的 map key 必须是**可比较的类型**。
-   可以：`bool`, `int`, `float`, `string`, `pointer`, `channel`, `interface`, `struct`, `array`。
-   **不可以**：`slice`, `map`, `function`。

这与 JavaScript 的 `Map` 不同（JS Map 的 key 可以是任何对象），也与 JS 的 `Object` 不同（Object 的 key 只能是 string 或 symbol）。

## 2. 初始化：Nil Map 陷阱

这是新手最容易犯的错误。

### 2.1 声明但不初始化

```go
var m map[string]int
// m 是 nil
// fmt.Println(m["a"]) // 输出 0 (读取是安全的，返回零值)
// m["a"] = 1 // Panic! (写入会导致程序崩溃)
```

**记住：永远不要向 nil map 写入数据。**

### 2.2 正确的初始化方式

**方式一：使用 make**
```go
m := make(map[string]int) // 创建一个空的 map，不是 nil
m["a"] = 1 // 正确
```

**方式二：字面量**
```go
m := map[string]int{
    "apple":  10,
    "banana": 20,
}
```

## 3. 核心操作

### 3.1 增删改查

```go
m := make(map[string]int)

// 增加/修改
m["age"] = 18
m["age"] = 19 // 覆盖

// 获取
age := m["age"]

// 删除
delete(m, "age") // 如果 key 不存在，什么也不会发生，不会报错
```

### 3.2 判断 Key 是否存在 (Comma-ok Idiom)

在 JavaScript 中，我们判断属性是否存在通常用 `if (obj.age !== undefined)`。

在 Go 中，如果你获取一个不存在的 key，它会返回该类型的**零值**。
-   如果 map 是 `map[string]int`，获取不存在的 key 返回 `0`。
-   如果 map 是 `map[string]string`，获取不存在的 key 返回 `""`。

这就带来一个问题：如果我取到了 `0`，是因为这个 key 的值本身就是 0，还是因为 key 不存在？

Go 提供了一个特殊的写法来解决这个问题：

```go
score, ok := m["math"]
if ok {
    fmt.Println("数学成绩是:", score)
} else {
    fmt.Println("没有数学成绩")
}
```

这就是著名的 **comma-ok 断言**。

## 4. 遍历 Map

使用 `for range` 遍历。

```go
m := map[string]string{
    "name": "Tom",
    "city": "Beijing",
}

for k, v := range m {
    fmt.Println(k, v)
}
```

**重要区别：无序性**

-   **JavaScript Map**: 遍历顺序与插入顺序一致。
-   **Go Map**: **遍历顺序是随机的！** 每次运行程序，输出的顺序可能都不一样。这是 Go 故意设计的，为了防止开发者依赖某种特定的哈希实现顺序。

如果你需要按顺序遍历，必须先将 key 取出来放到切片中，排序后，再遍历切片。

## 5. 复杂结构：Map 与 Slice 的结合

在前端开发中，我们经常处理 JSON 数据，比如一个对象数组。在 Go 中，这对应于 `[]map[string]interface{}` 或结构体切片。

```go
// 元素为 map 的切片
users := make([]map[string]string, 0)

user1 := map[string]string{"name": "Tom"}
users = append(users, user1)
```

## 6. 总结

Go 的 map 是一个强大但需要小心使用的数据结构。

1.  **Key 必须可比较**。
2.  **必须初始化**才能写入（使用 `make`）。
3.  **读取不存在的 Key 返回零值**，使用 `v, ok := m[k]` 来判断是否存在。
4.  **遍历是无序的**。

掌握了 Map 和 Slice，你已经可以处理绝大多数的数据逻辑了。但 Go 还有更高级的抽象——函数。下一篇文章，我们将探讨 Go 语言中的函数，以及它的一等公民地位。

---

**上一篇**：[12.Go 语言基础之切片](./12.Go%20语言基础之切片.md)
**下一篇预告**：[14.Go 语言基础之函数](./14.Go%20语言基础之函数.md)
